{% extends "base.html" %}
{% block content %}
<div class="mt-4">
    <h1>Add Platform</h1>
    <form id="addPlatformForm" method="POST" action="">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.platform_type.label(class="form-label") }}
            {{ form.platform_type(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.actors.label(class="form-label") }}
            <div class="form-check">
                {% for value, label in form.actors.choices %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="actors" value="{{ value }}" {% if
                        form.actors.data is not none and value in form.actors.data %} checked {% endif %}>
                    <label class="form-check-label">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="form-group">
            {{ form.scripts.label(class="form-label") }}
            <div class="form-check">
                {% for value, label in form.scripts.choices %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="scripts" value="{{ value }}" {% if
                        form.scripts.data is not none and value in form.scripts.data %} checked {% endif %}>
                    <label class="form-check-label">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="form-group">
            {{ form.directors.label(class="form-label") }}
            <div class="form-check">
                {% for value, label in form.directors.choices %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="directors" value="{{ value }}" {% if
                        form.directors.data is not none and value in form.directors.data %} checked {% endif %}>
                    <label class="form-check-label">{{ label }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="form-group mt-2">
            <button type="submit" id="addPlatformBtn" class="btn btn-primary">Add Platform</button>
        </div>
    </form>

    <h1>Platforms List</h1>
    <table class="table" id="platformsTable">
        <thead>
            <tr>
                <th>Type</th>
                <th>Actions</th>
                <th>Directors</th>
                <th>Scripts</th>
            </tr>
        </thead>
        <tbody>
            {% for platform in platforms %}
            <tr id="platform_{{ platform.id }}">
                <td>{{ platform.platform_name }}</td>
                <td>
                    <!-- Вывод имен актеров -->
                    {% for actor in platform.actors %}
                    {{ actor.name }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <!-- Вывод имен режиссеров -->
                    {% for director in platform.directors %}
                    {{ director.name }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <!-- Вывод названий сценариев -->
                    {% for script in platform.scripts %}
                    {{ script.title }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td>
                    <button class="btn btn-warning editPlatformBtn" data-platform-id="{{ platform.id }}">Edit</button>
                    <button class="btn btn-danger deletePlatformBtn" data-platform-id="{{ platform.id }}">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<script>
    $(document).ready(function() {
        // Delete Platform
        $(document).on('click', '.deletePlatformBtn', function() {
            var platformId = $(this).data('platform-id');
            if (confirm('Are you sure you want to delete this platform?')) {
                $.ajax({
                    type: 'POST',
                    url: '/delete_platform/' + platformId,
                    data: { '_method': 'DELETE' },
                    success: function(response) {
                        $('#platform_' + platformId).remove();
                        alert('Platform deleted successfully!');
                    },
                    error: function(xhr, status, error) {
                        alert('Error deleting platform: ' + xhr.responseText);
                    }
                });
            }
        });

        // Edit Platform
        $(document).on('click', '.editPlatformBtn', function() {
    var platformId = $(this).data('platform-id');
    var newType = prompt('Enter new type for platform:');
    if (newType != null && newType.trim() != '') {
        $.ajax({
            type: 'POST',
            url: '/edit_platform/' + platformId,
            data: { 'platform_name': newType },
            success: function(response) {
                $('#platform_' + platformId + ' td:first-child').text(response.platform_name);
                alert('Platform updated successfully!');
            },
            error: function(xhr, status, error) {
                alert('Error updating platform: ' + xhr.responseText);
            }
        });
    }
});
    });
</script>
{% endblock %}
